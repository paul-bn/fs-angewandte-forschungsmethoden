#paulbenjaminsimport pandas as pd import os import numpy as npimport matplotlib.pyplot as pltimport statsmodels.api as smfrom scipy.stats import shapirofrom statsmodels.tsa.stattools import adfullerfrom statsmodels.stats.diagnostic import het_breuschpaganimport matplotlib.ticker as mtickerimport quantstats as qsos.chdir("/Users/paulbenjamins/Desktop/data_afm")df = pd.read_csv("factors.csv")#df = df.drop(columns=(["Unnamed: 0","HML_Europe","HML_Global","HML_US","SMB_Europe","SMB_Global","SMB_US","UMD_Europe","UMD_Global","UMD_US","D.Recession","P.Recession"]))df = df.drop(columns=(["Unnamed: 0","UMD_Europe","UMD_Global","UMD_US","D.Recession","P.Recession"]))df["RF"] = df["RF"] / 100# ===================================#scatter plot of the regression, checking for linearity (BLUE)def linear_regression_plot (a,b,title):    X = sm.add_constant(a)    model = sm.OLS(b, X).fit()    Y = model.predict(X)    model.summary()    plt.scatter(a, b, alpha=0.8, s = 7)    plt.plot(a, Y, color="red")            plt.axhline(0, linewidth=1, color="black")    plt.axvline(0, linewidth=1, color="black")    plt.xlabel("Market excess return")    plt.ylabel("BAB excess return")    plt.title(title)        plt.tight_layout()    plt.show()    linear_regression_plot (df["Mkt_Global"], df["BAB_Global"],"GLOBAL")linear_regression_plot (df["Mkt_Europe"], df["BAB_Europe"],"EUROPE")linear_regression_plot (df["Mkt_US"], df["BAB_US"],"US")#adf test (stationarity), spearman correlation, summary of the regression parametersdef linear_regression_stats(a,b):    X = sm.add_constant(a)    model = sm.OLS(b, X).fit()    model.summary()        #adf test    result = adfuller(b)        print(result)        print('ADF Statistic:', result[0])    print('p-value:', result[1])        rho = df["Mkt_Global"].corr(df["BAB_Global"], method="spearman")    print("\n","spearman correlation: ", rho)        print("\n", model.params)    print(model.summary())      linear_regression_stats(df["Mkt_Global"], df["BAB_Global"])linear_regression_stats(df["Mkt_Europe"], df["BAB_Europe"])linear_regression_stats(df["Mkt_US"], df["BAB_US"])#test for normal distribution: shapiro , qq plotdef check_for_N(x,title):    stats,p=shapiro(x)    print("stat: ", stats, "p-value: ", p)        if p<0.05:        print("\n" "Since the p value " , p , "is smaller than 0.05, we reject the null hypothesis that the data is normally distributed")        sm.qqplot(df["BAB_Global"], line='45',fit=True)    plt.title(title)    plt.show()   check_for_N(df["BAB_Global"],"BAB GLOBAL")check_for_N(df["BAB_Europe"], "BAB Europe")check_for_N(df["BAB_US"],"BAB US")check_for_N(df["Mkt_Global"],"Mkt Global")check_for_N(df["Mkt_Europe"], "Mkt Europe")check_for_N(df["Mkt_US"],"Mkt US")#check for homoskedasticity using graphical and bp testdef skedas_checker(x,y,title):    X = sm.add_constant(x)    model = sm.OLS(y, X).fit()    data = pd.DataFrame({        "fitted": model.fittedvalues,           "residuals": model.resid              })        plt.scatter(data["fitted"], data["residuals"],s=7)          plt.axhline(y=0, color="black", lw=1)          plt.xlabel("ŷ")    plt.ylabel("residuals (y - ŷ)")    plt.title("hetereo/homo skedasticity – scatter plot " + title)    plt.show()        plt.plot(model.resid)    plt.ylabel("residuals (y - ŷ)")    plt.show()        bp_test = het_breuschpagan(model.resid, model.model.exog)    labels = ['Lagrange multiplier statistic', 'p-value', 'f-value', 'f p-value']    print(dict(zip(labels, bp_test)))skedas_checker(df["Mkt_Global"],df["BAB_Global"],"Global")skedas_checker(df["Mkt_Europe"],df["BAB_Europe"],"Europe")skedas_checker(df["Mkt_US"],df["BAB_US"],"US")###################homework#a)res = df.loc[:,"Mkt_Europe":].describe().iloc[np.r_[1:3,4:7],:]res.loc["IQR"] = res.iloc[4] - res.iloc[2]res=res.rename(index={"50%":"median"})res = res.iloc[[3,5,0,1],:]res.to_excel("res.xlsx")#b) density hist!!!!!!!def hist (x,title):    os.chdir("/Users/paulbenjamins/Desktop/")    plt.figure(figsize=(8, 5))    plt.style.use('seaborn-v0_8-whitegrid')      plt.hist(x, bins=np.arange(-0.2,0.2, 0.005),density=True, color='blue', edgecolor='black', alpha=0.7)    plt.title(title, fontsize=14, fontweight='bold')    plt.xlabel('excess return', fontsize=12)    plt.ylabel('density', fontsize=12)    plt.gca().yaxis.get_major_formatter().set_useOffset(False)       plt.gca().yaxis.set_major_locator(plt.MaxNLocator(integer=True))    plt.gca().yaxis.set_major_locator(mticker.MultipleLocator(2))    plt.ylim(0,28)     #plt.savefig(title,dpi=600)    plt.show()     hist(df["BAB_US"],"BAB US")hist(df["Mkt_US"],"Market US")hist(df["BAB_Europe"],"BAB Europe")hist(df["Mkt_Europe"],"Market Europe")hist(df["Mkt_Global"],"Market Global")hist(df["BAB_Global"],"BAB Global")# boxplotbab_box = df[["BAB_US", "BAB_Europe", "BAB_Global"]]bab_box.boxplot()plt.show()mkt_box = df[["Mkt_US", "Mkt_Europe", "Mkt_Global"]]mkt_box.boxplot()plt.show()#d,e irrelevant due to duplication#f)df["D.Recession"].describe().to_frame()df["P.Recession"].describe().to_frame()#t Test#t_stat, p_value, dfree = sm.ttest_mean(df["BAB_US"], value=0)# Mann Whitneyqs.extend_pandas()a= df["BAB_Global"].sharpe(periods=12)b = df["BAB_Global"].mean() / df["BAB_Global"].std()b=b*12**0.5sharpe_Mkt_g = df["Mkt_Global"].mean() / df["Mkt_Global"].std()def wealth_index (mktinput,babinput,rfinput,time):    final = pd.DataFrame()    final["BAB_total_return"] = babinput + rfinput    final["Mkt_total_return"] = mktinput + rfinput        final["BAB"] = (1+final["BAB_total_return"]).cumprod().to_frame()    final["Mkt"] = (1+final["Mkt_total_return"]).cumprod().to_frame()    final["time"] = time    final = final.set_index("time")    plt.plot(final.index.astype(str), final[["BAB","Mkt"]].values, label=["BAB","Market"])    plt.gca().xaxis.set_major_locator(plt.MaxNLocator(15))    plt.xticks(rotation=60)    plt.title("Global")    plt.legend()    plt.tight_layout()    plt.show()wealth_index(df["Mkt_Global"],df["BAB_Global"],df["RF"],df["mdate"])from statistics import geometric_meangeo_mean = geometric_mean(1 + df["Mkt_Global"]) - 1geo_mean1 = geometric_mean(1 + df["BAB_Global"]) - 1#RobustheitstestX = df[["SMB_US","HML_US","Mkt_US"]]X = sm.add_constant(X)model = sm.OLS(df["BAB_US"],X).fit()Y = model.predict(X)fig = plt.figure(figsize=(8,6))sm.graphics.plot_partregress_grid(model, fig=fig)plt.tight_layout()plt.show()             